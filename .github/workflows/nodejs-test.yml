name: Node.js Test

on:
  workflow_call:
    inputs:
      # <--------------- ESLint Setting ---------------> 
      eslint-enable:
        required: false
        type: boolean
        description: Enable ESLint
        default: false

      eslint-command:
        required: false
        type: string
        description: ESLint command
        default:  npx eslint '**/*.{js,ts,tsx}'

      # <--------------- UNIT-TEST SETTINGS --------------> 
      unit-test-enable:
        required: false
        type: boolean
        description: "To disable the unit-tests job set to false"
        default: true
      unit-test-command:
        required: false
        type: string
        description: "Used to override the default command to run your unit tests e.g. yarn test:unit-ci"
        default: "npm run test:unit-ci"

      node-version:
        required: false
        type: string
        description: Node.js version
        default: '21'  # Default version of Node.js

    secrets:
      token:
        required: true 

jobs:
  # <---------------------- ESLINT ----------------------> 
  eslint:
    name: ESLint Check
    runs-on: ubuntu-22.04
    if: ${{ inputs.eslint-enable }}
    steps:
      - name: Checkout Source
        uses: actions/checkout@v4
      
      # Checkout the workflows repo to access `eslint.config.mjs`
      - name: Checkout Workflows Repo
        uses: actions/checkout@v4
        with:
          repository: Ridvan-bot/workflows
          path: workflows-repo

      - name: Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ inputs.node-version }}

      - name: Install Dependencies
        run: |
          cd workflows-repo 
          npm install

      - name: Run ESLint
        run: |
          # Ensure CI environment is set to avoid prompts
          export CI=true
          # Run ESLint using the config from the workflows-repo
          npx eslint --config ./workflows-repo/eslint.config.mjs '**/*.{js,ts,tsx}'
      